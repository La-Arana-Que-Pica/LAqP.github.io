<link rel="icon" href="img/Logo Web.png" type="image/png" sizes="32x32">
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Equipos - LAqP</title>
  <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Press+Start+2P&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">

  <!-- Rediseño filtros (alineado con jugadores) -->
  <style>
    :root{
      --panel-bg:linear-gradient(180deg,rgba(12,14,22,.85),rgba(8,8,12,.92));
      --panel-border:1px solid rgba(255,255,255,.08);
      --select-bg:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.05));
      --select-bd:1px solid rgba(255,255,255,.18);
      --accent:linear-gradient(90deg,var(--neon-cyan),var(--neon-pink));
    }

    .brand h1, .brand h1 a{color:#fff !important;text-decoration:none}

    .filters-wrap{
      background:var(--panel-bg);
      border:var(--panel-border);
      border-radius:22px;
      padding:18px 20px 16px;
      margin:22px 0 14px;
      box-shadow:0 18px 60px rgba(0,0,0,.60);
      display:flex;
      flex-direction:column;
      gap:14px;
      position:relative;
      overflow:hidden;
      isolation:isolate;
    }
    .filters-wrap::before{
      content:"";
      position:absolute;inset:0;
      background:
        radial-gradient(600px 220px at 120% -10%,rgba(0,255,231,.18),transparent 70%),
        radial-gradient(600px 220px at -10% 120%,rgba(255,0,170,.14),transparent 70%);
      mix-blend-mode:screen;
      opacity:.5;
      pointer-events:none;
      z-index:-1;
    }

    .filters-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
      gap:14px 16px;
      align-items:end;
    }
    .fg{display:flex;flex-direction:column;gap:6px;min-width:0}
    .fg label{
      font-family:'Press Start 2P';
      font-size:.55rem;
      letter-spacing:.85px;
      font-weight:800;
      color:#9ee1ef;
      text-transform:uppercase;
    }
    .fg input,
    .fg select{
      padding:10px 12px 9px;
      border-radius:12px;
      color:#fff;
      font-size:.75rem;
      letter-spacing:.45px;
      font-family:Roboto,Arial,sans-serif;
      min-width:0;
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.14);
      color-scheme:dark;
      transition:.18s;
    }
    .fg input:focus,
    .fg select:focus{
      outline:2px solid var(--neon-cyan);
      box-shadow:0 0 0 4px rgba(0,255,231,.25);
    }

    .fg select{
      appearance:none;
      -webkit-appearance:none;
      background:var(--select-bg);
      border:var(--select-bd);
      padding-right:34px;
      background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%23aefaff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><polyline points='6 9 12 15 18 9'/></svg>");
      background-repeat:no-repeat;
      background-position:right 10px center;
      background-size:16px;
    }
    .fg select:focus{
      border-color:rgba(0,255,231,.45);
      background:linear-gradient(180deg,rgba(255,255,255,.12),rgba(255,255,255,.06));
    }
    .fg select option{background:#12141b;color:#e6f9f9;}

    .filters-actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:2px;
    }
    .pill-btn{
      padding:10px 16px 9px;
      border-radius:14px;
      background:var(--accent);
      color:#071014;
      font-family:'Press Start 2P';
      font-size:.58rem;
      letter-spacing:.85px;
      font-weight:800;
      text-decoration:none;
      border:none;
      cursor:pointer;
      transition:.22s cubic-bezier(.2,.9,.3,1);
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .pill-btn.secondary{
      background:rgba(255,255,255,.10);
      color:#fff;
      border:1px solid rgba(255,255,255,.16);
    }
    .pill-btn:hover{
      transform:translateY(-5px);
      filter:saturate(1.12);
      box-shadow:0 20px 60px rgba(0,255,231,.30),0 10px 40px rgba(255,0,170,.24);
    }
    .pill-btn.secondary:hover{
      background:rgba(255,255,255,.18);
      box-shadow:0 10px 36px rgba(0,0,0,.45);
    }

    .grid-cards{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
      gap:18px;
      margin:6px 0 40px;
    }
    .team-card{
      position:relative;
      display:flex;
      gap:14px;
      padding:16px 16px 14px;
      align-items:center;
      background:linear-gradient(180deg,rgba(16,18,28,.92),rgba(10,10,14,.94));
      border:1px solid rgba(255,255,255,.06);
      border-radius:22px;
      text-decoration:none;
      color:inherit;
      box-shadow:0 18px 60px rgba(0,0,0,.60);
      overflow:hidden;
      isolation:isolate;
      transition:.25s cubic-bezier(.2,.9,.3,1);
      min-height:126px;
    }
    .team-card::before{
      content:"";
      position:absolute;inset:0;
      background:
        radial-gradient(520px 180px at 120% -10%,rgba(0,255,231,.16),transparent 70%),
        radial-gradient(520px 180px at -10% 120%,rgba(255,0,170,.14),transparent 70%);
      mix-blend-mode:screen;
      opacity:.55;
      pointer-events:none;
      z-index:-1;
    }
    .team-card:hover{
      transform:translateY(-6px);
      box-shadow:0 26px 90px rgba(0,0,0,.7),0 0 24px rgba(0,255,231,.30),0 0 18px rgba(255,0,170,.28);
      border-color:rgba(0,255,231,.35);
    }
    .team-logo{
      width:70px;
      height:70px;
      border-radius:16px;
      object-fit:cover;
      border:2px solid rgba(255,255,255,.10);
      background:#000;
      box-shadow:0 12px 34px rgba(0,0,0,.55);
      flex-shrink:0;
      transition:.25s;
    }
    .team-card:hover .team-logo{filter:brightness(1.07) contrast(1.05)}
    .team-info{flex:1;display:flex;flex-direction:column;gap:6px;min-width:0}
    .team-name{
      font-family:'Bungee','Press Start 2P',monospace;
      font-size:1rem;
      color:#fff;
      letter-spacing:.55px;
      line-height:1.05;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
    }
    .team-meta{
      font-size:.72rem;
      color:#cfecec;
      letter-spacing:.45px;
      display:flex;
      flex-wrap:wrap;
      gap:8px 12px;
      align-items:center;
    }
    .flag{
      width:26px;
      height:18px;
      object-fit:cover;
      border-radius:4px;
      border:1px solid rgba(255,255,255,.35);
      box-shadow:0 0 8px rgba(0,0,0,.45);
    }
    .tag-inline{
      padding:4px 8px 3px;
      border-radius:8px;
      background:var(--accent);
      color:#071014;
      font-family:'Press Start 2P';
      font-size:.55rem;
      letter-spacing:.8px;
      font-weight:800;
      box-shadow:0 8px 26px rgba(0,255,231,.16),0 6px 22px rgba(255,0,170,.16);
    }
    .no-results{
      grid-column:1/-1;
      padding:16px;
      background:linear-gradient(180deg,rgba(20,20,26,.85),rgba(12,12,16,.85));
      border:1px solid rgba(255,255,255,.06);
      border-radius:16px;
      font-size:.9rem;
      color:#dff;
      text-align:center;
      box-shadow:0 12px 40px rgba(0,0,0,.55);
    }
    @media (max-width:600px){
      .grid-cards{grid-template-columns:repeat(auto-fill,minmax(220px,1fr))}
      .team-logo{width:60px;height:60px}
      .team-name{font-size:.9rem}
    }

    .team-card:focus,
    .pill-btn:focus,
    .fg input:focus,
    .fg select:focus{
      outline:2px solid var(--neon-cyan);
      outline-offset:3px;
      box-shadow:0 0 0 6px rgba(0,255,231,.25);
    }
  </style>
</head>
<body>
  <div class="page-bg" aria-hidden="true"></div>
  
  <div class="wrap">
    <header class="site-header" role="banner" aria-label="Cabecera del sitio">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <h1><a href="index.html">LAqP</a></h1>
      </div>
      <nav class="main-nav" role="navigation" aria-label="Menú principal">
        <a href="ligas.html">Ligas</a>
        <a href="equipos.html" aria-current="page">Equipos</a>
        <a href="jugadores.html">Jugadores</a>
      </nav>
    </header>

    <div class="page-title">Equipos</div>

    <section class="filters-wrap" role="region" aria-label="Filtros de equipos">
      <div class="filters-grid">
        <div class="fg">
          <label for="q">Buscar</label>
          <input id="q" type="search" placeholder="Nombre de equipo" autocomplete="off">
        </div>
        <div class="fg">
          <label for="league">Liga</label>
          <select id="league"><option value="">Todas</option></select>
        </div>
        <div class="fg">
          <label for="country">País</label>
          <select id="country"><option value="">Todos</option></select>
        </div>
        <div class="fg">
          <label for="sort">Orden</label>
          <select id="sort">
            <option value="name_asc">Nombre (A-Z)</option>
            <option value="name_desc">Nombre (Z-A)</option>
            <option value="league_name">Liga + Nombre</option>
          </select>
        </div>
      </div>
      <div class="filters-actions">
        <button class="pill-btn" id="applyFilters" type="button">APLICAR</button>
        <button class="pill-btn secondary" id="resetFilters" type="button">RESET</button>
      </div>
    </section>

    <section id="list" class="grid-cards" aria-label="Listado de equipos"></section>

    <footer class="site-footer">© La Araña Que Pica — Página Oficial</footer>
  </div>

  <script src="js/db.js"></script>
  <script>
    (async function(){
      const $q=document.getElementById('q');
      const $league=document.getElementById('league');
      const $country=document.getElementById('country');
      const $sort=document.getElementById('sort');
      const $apply=document.getElementById('applyFilters');
      const $reset=document.getElementById('resetFilters');
      const $list=document.getElementById('list');

      // Bandera con acentos/ñ primero, fallback a versión normalizada
      function flagSrcWithAccents(country){
        if(!country) return '';
        const base = String(country).replace(/\.(png|jpe?g|webp|gif|svg)$/i,'').trim();
        return `img/flags/${encodeURIComponent(base)}.png`;
      }

      let leagues=[], teams=[], players=[], maps={};
      try{
        ({ leagues, teams, players, maps } = await DB.load({ leagues:true, teams:true, players:true }));
      }catch(e){
        $list.innerHTML='<div class="no-results">Error cargando data/*.json.</div>';
        return;
      }

      // Precalcular cantidad de jugadores por equipo
      const playerCountByTeam = {};
      for(const p of players){
        const tid = String(p.team_id||'');
        if(!tid) continue;
        playerCountByTeam[tid] = (playerCountByTeam[tid]||0) + 1;
      }

      leagues.slice().sort((a,b)=>a.name.localeCompare(b.name,'es')).forEach(l=>{
        const opt=document.createElement('option');
        opt.value=l.id; opt.textContent=l.name;
        $league.appendChild(opt);
      });

      const countries=Array.from(new Set(leagues.map(l=>l.country).filter(Boolean))).sort((a,b)=>a.localeCompare(b,'es'));
      countries.forEach(c=>{
        const opt=document.createElement('option');
        opt.value=c; opt.textContent=c;
        $country.appendChild(opt);
      });

      let current=teams.slice();

      function render(items){
        $list.innerHTML='';
        if(items.length===0){
          $list.innerHTML='<div class="no-results">Sin resultados</div>';
          return;
        }
        for(const t of items){
          const lg = maps.leagueById[t.league_id] || null;
          const count = playerCountByTeam[String(t.id)] || 0;

          const a=document.createElement('a');
          a.className='team-card';
          a.href=`equipo.html?slug=${encodeURIComponent(t.slug)}`;
          a.innerHTML=`
            <img class="team-logo" src="${t.logo||'img/equipos/placeholder.png'}" alt="${t.name}" onerror="this.src='img/equipos/placeholder.png'">
            <div class="team-info">
              <div class="team-name">
                ${t.name}
                ${lg? `<span class="tag-inline" title="País de la liga">${lg.country||''}</span>`:''}
                <span class="tag-inline" title="Jugadores creados en LAqP">${count}</span>
              </div>
              <div class="team-meta">
                ${lg? lg.name : 'Sin liga'}
                ${lg? `<img class="flag"
                            src="${flagSrcWithAccents(lg.country)}"
                            alt="${lg.country}"
                            onerror="if(!this.dataset.try2){this.dataset.try2=1;this.src='${DB.countryFlagSrc(lg.country)}'}else{this.style.display='none'}">` : ''}
              </div>
            </div>
          `;
          $list.appendChild(a);
        }
      }

      function apply(){
        const q=$q.value.trim().toLowerCase();
        const l=$league.value;
        const c=$country.value;
        let items=teams.slice();

        if(q){ items=items.filter(t=>(t.name||'').toLowerCase().includes(q)); }
        if(l){ items=items.filter(t=>String(t.league_id)===String(l)); }
        if(c){
          items=items.filter(t=>{
            const lg=maps.leagueById[t.league_id]||null;
            return lg && lg.country===c;
          });
        }

        switch($sort.value){
          case 'name_desc':
            items.sort((a,b)=>b.name.localeCompare(a.name,'es'));
            break;
          case 'league_name':
            items.sort((a,b)=>{
              const la=maps.leagueById[a.league_id]?.name || '';
              const lb=maps.leagueById[b.league_id]?.name || '';
              return la.localeCompare(lb,'es') || a.name.localeCompare(b.name,'es');
            });
            break;
          default:
            items.sort((a,b)=>a.name.localeCompare(b.name,'es'));
        }

        current=items;
        render(current);
      }

      // Eventos
      $apply.addEventListener('click', apply);
      $reset.addEventListener('click', ()=>{
        $q.value=''; $league.value=''; $country.value=''; $sort.value='name_asc'; apply();
      });
      $q.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); apply(); } });
      $q.addEventListener('input', DB.debounce(apply,220));
      [$league,$country,$sort].forEach(el=>el.addEventListener('change', apply));

      // Atajo "/"
      document.addEventListener('keydown', e=>{
        if(e.key==='/' && document.activeElement!==$q){
          e.preventDefault(); $q.focus();
        }
      });

      apply();
    })();
  </script>
</body>
</html>